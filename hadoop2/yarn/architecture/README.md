# 얀 아키텍처의 이해
## 얀의 전체적인 작업흐름
##### 얀의 전체적인 흐름을 설명하고 단계적 동작 방식을 설명한다.
![얀 작업흐름](https://github.com/googolhkl/TIL/blob/master/hadoop2/yarn/architecture/YarnWorkflow.png)

##### 1. 클라이언트는 애플리케이션 실행을 요청한다. 애플리케이션은 얀 API를 구현한 프로그램이면 어떤 애플리케이션이든 실행 가능하다. 이때 리소스매니저는 실행 요청이 유효할 경우 클라이언트에게 신규 애플리케이션ID를 할당한다.
##### 2. 리소스매니저는 노드매니저에게 애플리케이션마스터 실행을 요청한다.
##### 3. 노드매니저는 리소스매니저에게 요청을 받은 후 컨테이너에서 애플리케이션마스터를 실행한다. 이때 컨테이너는 새로운 JVM을 생성해 애플리케이션마스터를 실행한다.
##### 4. 애플리케이션마스터는 리소스매니저에게 애플리케이션을 실행하기 위한 리소스를 요청한다. 이때 리소스는 필요한 호스트와 랙 정보, 메모리, CPU, 네트워크 정보, 그리고 컨테이너 개수 등으로 구성된다. 리소스매니저는 전체 클러스터의 리소스 상태를 확인한 후 애플리케이션마스터에게 노드매니저 목록을 전송한다.
##### 5. 애플리케이션마스터는 리소스매니저에게 할당받은 노드매니저들에게 컨테이너 실행을 요청한다.
##### 6. 노드매니저들은 컨테이너에 새로운 JVM을 생성한 후 해당 애플리케이션을 실행한다. 애플리케이션이 종료되면 해당 애플리케이션마스터가 종료된다. 마지막으로 리소스매니저는 종료된 애플리케이션마스터에게 할당했던 리소스를 해제한다.

## 얀 단계별 동작 방식
##### 위에서 얀의 전체적인 작업 흐름을 보았다. 하지만 실제로 각 컴포넌트 간에는 더 복잡한 상호작용이 발생한다. 
### 1. 애플리케이션 실행 요청
##### 아래 그림은 YarnClient를 구현한 클래스인 클라이언트가 얀 클러스터에 애플리케이션 실행을 요청했을 때 진행되는 과정을 나타낸다. ClientRMService는 리소스매니저의 내부 컴포넌트로 클라이언트가 호출하는 모든 RPC 호츨을 처리한다.
![애플리케이션 실행 요청](https://github.com/googolhkl/TIL/blob/master/hadoop2/yarn/architecture/ApplicationExecutingRequest.png)

#####  1. 클라이언트가 애플리케이션을 얀 클러스터에서 실행하려면 얀 클러스터에서 신규 애플리케이션ID를 발급받아야 한다. 클라이언트는 ClientRMService의 createNewApplication 메소드를 호출해 애플리케이션ID 발급을 요청한다. 이 부분은 [Myclient](https://github.com/googolhkl/TIL/blob/master/hadoop2/yarn/application/com/hkl/hadoop/yarn/examples/MyClient.java#L216)에 185라인에 다음과 같이 작성되어 있다.

```
YarnClientApplication app = yarnClient.createApplication();
```
