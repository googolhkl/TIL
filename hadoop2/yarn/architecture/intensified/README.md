# 아키텍처 심화
##### [앞에서](https://github.com/googolhkl/TIL/tree/master/hadoop2/yarn/architecture) 얀의 단계별 동작 방식을 설명할 때 리소스매니저와 노드매니저의 내부 컴포넌트를 설명했다. 그런데 일부 내부 컴포넌트만을 설명했을 뿐이고 실제 리소스매니저와 노드매니저는 다양한 내부 컴포넌트로 구성돼 있다. 여기서는 리소스매니저와 노드매니저의 구조에 대해 자세히 알아본다.

## 1. 리소스 매니저
##### 리소스매니저는 전체 클러스터의 가용한 리소스를 스케줄링하고, 클러스터에서 실행되는 애플리케이션들에게 리소스를 중재한다. 그리고 노드매니저와 애플리케이션마스터를 제어하면서 애플리케이션들이 정상적으로 실행될 수 있게 도와준다. 리소스 매니저는 이러한 기능을 수행하기 위해 다양한 컴포넌트로 구성돼 있다. 다음은 리소스매니저의 컴포넌트 구성이다.

![리소스매니저 컴포넌트](https://github.com/googolhkl/TIL/blob/master/hadoop2/yarn/architecture/intensified/ResourceManager.png)

### 주요 컴포넌트
 - RMContext : 리소스 매니저의 컨텍스트 정보를 유지한다.
 - Dispatcher : 이벤트 전달을 위한 인터페이스다. 이 인터페이스는 이벤트 유형에 맞는 이벤트 핸들러에게 이벤트를 전달한다. 참고로 리소스 매니저는 Dispatcher 인터페이스를 구현하기 위해 비동기 디스패처를 생성한다.
 - ResourceScheduler : 이 컴포넌트는 YarnScheduler 인터페이스를 확장한 인터페이스다. 이 인터페이스는 클러스터에서 실행되는 애플리케이션에게 리소스를 할당하는 역할을 담당한다. 이를 위해 스케줄러 큐 정보 조회, 가용 리소스 조회, 리소스 할당, 노드 수 조회 등 다양한 기능을 제공한다. ResourceScheduler는 인터페이스이기 때문에 이를 구현한 클래스를 생성해야만 실제 스케줄 기능을 수행할 수 있다. 현재 기본 스케줄러는 커패시티 스케줄러를 사용하고 있으며, 얀 설정 파일의 scheduler.class 옵션으로 스케줄러를 설정할 수 있다. 참고로 클러스터의 가용한 자원은 메모리, CPU, 디스크, 네트워크 정보가 있지만 현재 커패시티 스케줄러는 CPU와 메모리만으로 자원 스케줄링을 하고 있다.

